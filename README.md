# COMP

> 기업 재무제표 쉽게 확인 할 수 있는 웹사이트

DART에 공시된 기업 재무제표를 쉽게 확인 할 수 있는 서비스.

3년치의 재무제표를 한번에 확인할 수 있다.

여러 조건을 조합해서 해당하는 기업을 찾을 수 있다.

카카오로 쉽게 로그인할 수 있다.

서비스 URL : http://3.20.42.141 (배포중단)



## 프로젝트 진행 소개

- 혼자 진행

- 프로젝트 기간: 2022.5.20 ~ 2022.6.27

- 프로젝트 기간(ver2) : 2022.08.13 ~ 2022.09.29

- 활용 기술

  개발: Spring boot, Spring Data JPA + QueryDSL, MYSQL

  배포: AWS EC2, Docker, Jenkins, Nginx

## 주요 기능

| 구분 | 기능                                                         | 설명                                                         |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1    | 기업 재무제표 확인                                           | Dart Open-api를 사용해서 해당 기업의 3년치의 재무제표를 보여준다.<br />Dart Open api의 데이터를 데이터베이스에 저장해놔서 요청마다 외부로 api 요청하지 않아도 된다.(ver2) |
| 2    | 회원 가입 & 로그인                                           | JWT + OAuth2를 사용해서 로그인 기능을 구현했으며, 카카오로 쉽게 로그인할 수 있다.<br />RefreshToken 추가.(ver2) |
| 3    | [무중단 배포](https://github.com/juyongc/PJT_COMP/blob/master/cicd%20%EA%B3%BC%EC%A0%95/CICD.md) | 서버 컨테이너 두 개를 사용한다. <br />현재 배포중인 컨테이너가 있다면 다른 컨테이너에 새 배포 파일을 업로드하고 배포하고, 이전 배포중인 컨테이너는 내리는 형식으로 구현했다. |
| 4    | 즐겨찾기 기능                                                | 사용자가 관심 있는 기업을 추가해서 한번에 편하게 확인할 수 있다.(ver2) |
| 5    | 기업 조건검색                                                | 사용자가 여러 조건을 조합해서 기업을 검색할 수 있다.(ver2)   |



## 고민했던 부분 및 회고

### Open API 접근에 대한 방법 변경

- 문제점

  version 1에서는 사용자의 요청마다 Dart Open api로 요청이 나가는 구조로 시스템을 만들었다.

  그런데 한 번 기업을 검색하는데 api 요청이 두 번(기업 관련 정보 + 기업 재무제표) 나가야 했고,

  Dart open api는 일 10,000회까지만 요청할 수 있어서 일인당 한번씩만 검색한다고 해도 5,000명만 사용할 수 있었다.

  모든 사용자가 한번만 검색하지는 않을 것이기에 일일 요청 수를 증가시킬 수 있는 방법을 생각해야 했다.

- 방법 1

  처음에는 api 키를 여러 개 받아놓고 요청 당 카운팅하면서 9,000개 정도가 되면 다른 api 키를 사용하는 방식을 고려했다.

  하지만 근본적인 해결책은 아니라 다른 방법을 생각해보기로 했다.

- 방법 2

  생각해보면 재무제표는 거의 분기별로 대규모로 변경된다.

  찾아보니 기업 수도 4000여개 정도여서 일일 요청 제한내에서 모든 기업 정보를 갱신할 수 있다.

  따라서 사용자의 요청마다 오픈 api로 나가는 대신 기업 데이터를 DB에 갱신하고,

  사용자의 요청은 DB와 통신하는 방법을 생각했다.

  version 2에서는 이 방법으로 구현했다.

  

### Refresh token 추가

- version 1에서는 access token만 사용해서 인증했다.

  refresh token을 사용하면 refresh token과 access token 정보를 db에 저장해서 검증해야 하고

  access token 유효 기간이 지날 때마다 매번 변경해줘야 해서 성능면에서 마이너스라고 생각했다.

  결제와 같은 사용자에게 민감한 서비스가 없고 사용자에 대한 민감한 정보도 사용하지 않아서 괜찮을 것이라 생각했다.

- version 2에서는 refresh token을 추가했다.

  사용자 입장에서는 성능보다 보안이 중요할 것이라 생각해서 refresh token을 도입했다.

  초반에 너무 토이 프로젝트라고 생각하고 접근했던 것 같다.



### 기타 

- 필드 주입 대신 생성자 주입을 왜 권장하는지 이해할 수 있었다. 

  version 1 에서 version 2로 클래스를 변경하기 위해 많은 클래스를 일일이 확인해야 했다.

- 배포를 진행하면서 Nginx가 매우 다재다능하다는 생각이 들었다. 

  캐시 및 로드밸런싱을 더 공부해서 추가해보면 좋을 것 같다.



## 구조도

![image-20220627173815747](README.assets/image-20220627173815747-16563191114933.png)

## 사용 예시

**[로그인 & 기업 재무제표 확인]**

<img src="README.assets/login_test.gif" alt="login_test" style="zoom: 50%;" />

